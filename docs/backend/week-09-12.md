# Week 9-12: ë©¤ë²„ì‹­ ë° í˜œíƒ ì‹œìŠ¤í…œ

**ê¸°ê°„**: Week 9-12
**ëª©í‘œ**: ì ë¦½ê¸ˆ, ì˜ˆì¹˜ê¸ˆ, ì¿ í°, íšŒì› ë“±ê¸‰, ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì‹œìŠ¤í…œ êµ¬í˜„
**ê¸°ìˆ  ìŠ¤íƒ**: Spring Data JPA, Spring Scheduling, Enum, Transaction Management
**í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™**: Week 9ë¶€í„° ì‹œì‘

---

## ğŸ“‹ Issue Tickets

### [BE-029] Mileage (ì ë¦½ê¸ˆ) Transaction ì‹œìŠ¤í…œ êµ¬í˜„

**Priority**: ğŸ”´ Critical
**Estimated Time**: 8 hours

#### Description

ì ë¦½ê¸ˆ ì ë¦½, ì‚¬ìš©, í™˜ë¶ˆ, ë§Œë£Œ ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” Transaction ê¸°ë°˜ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤. ì ë¦½ê¸ˆì€ 1ë…„ í›„ ìë™ ë§Œë£Œë˜ë©°, ë§¤ì¼ ìì • ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ë§Œë£Œëœ ì ë¦½ê¸ˆì„ ì°¨ê°í•©ë‹ˆë‹¤.

#### Functional Requirements

**1. MileageTransaction Entity ì„¤ê³„**
ë‹¤ìŒ í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” MileageTransaction Entityë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**í•„ë“œ:**

- id (Long, PK, Auto Increment)
- user (User, Many-to-One, NOT NULL, Lazy)
- amount (Integer, NOT NULL) - ì–‘ìˆ˜: ì ë¦½, ìŒìˆ˜: ì‚¬ìš©/ë§Œë£Œ
- transactionType (MileageTransactionType, Enum, NOT NULL) - ê±°ë˜ ìœ í˜•
- description (String, max 255ì) - ê±°ë˜ ì„¤ëª…
- orderId (Long, nullable) - ì£¼ë¬¸ ì°¸ì¡° (ì„ íƒ ì‚¬í•­)
- expiresAt (LocalDateTime, nullable) - ì ë¦½ê¸ˆ ë§Œë£Œì¼ (ì ë¦½ ì‹œì—ë§Œ ì„¤ì •)
- createdAt (BaseEntity ìƒì†)

**MileageTransactionType Enum:**

- EARN_PURCHASE - êµ¬ë§¤ ì ë¦½
- EARN_REVIEW - ë¦¬ë·° ì‘ì„± ì ë¦½
- EARN_SIGNUP - íšŒì›ê°€ì… ì ë¦½
- EARN_EVENT - ì´ë²¤íŠ¸ ì ë¦½
- USE - ì‚¬ìš©
- EXPIRE - ë§Œë£Œ
- REFUND - í™˜ë¶ˆ

**ì¸ë±ìŠ¤:**

- idx_mileage_transactions_user_id: user_id
- idx_mileage_transactions_expires_at: expires_at

**2. MileageTransactionRepository ì¸í„°í˜ì´ìŠ¤**
JpaRepositoryë¥¼ í™•ì¥í•˜ê³  ë‹¤ìŒ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤:

**ì¡°íšŒ ë©”ì„œë“œ:**

- findByUserIdOrderByCreatedAtDesc(Long userId): List<MileageTransaction>
- findByUserIdOrderByCreatedAtDesc(Long userId, Pageable pageable): Page<MileageTransaction>

**JPQL ì¿¼ë¦¬:**

- getTotalMileageByUserId(@Param("userId") Long userId, @Param("now") LocalDateTime now): Integer
  - SUM(mt.amount)ë¥¼ ê³„ì‚°í•˜ì—¬ ì‚¬ìš©ìì˜ ìœ íš¨í•œ ì ë¦½ê¸ˆ ì”ì•¡ ë°˜í™˜
  - ë§Œë£Œë˜ì§€ ì•Šì€ ì ë¦½ê¸ˆë§Œ í•©ì‚° (expiresAt > now)
  - COALESCEë¡œ null ëŒ€ì‹  0 ë°˜í™˜

- findExpiredMileage(@Param("now") LocalDateTime now): List<MileageTransaction>
  - expiresAt < now AND amount > 0 ì¡°ê±´
  - ë§Œë£Œë˜ì—ˆì§€ë§Œ ì•„ì§ ì°¨ê°ë˜ì§€ ì•Šì€ ì ë¦½ê¸ˆ ì¡°íšŒ

**3. MileageService ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**
ì ë¦½ê¸ˆ ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” Serviceë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**getUserMileageBalance(Long userId): Integer**

- ì‚¬ìš©ìì˜ í˜„ì¬ ìœ íš¨í•œ ì ë¦½ê¸ˆ ì”ì•¡ ì¡°íšŒ
- Repository.getTotalMileageByUserId() í˜¸ì¶œ
- ë§Œë£Œë˜ì§€ ì•Šì€ ì ë¦½ê¸ˆë§Œ í•©ì‚°
- @Transactional(readOnly = true)

**getUserMileageHistory(Long userId, Pageable pageable): Page<MileageTransactionResponse>**

- ì‚¬ìš©ìì˜ ì ë¦½ê¸ˆ ë‚´ì—­ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
- createdAt ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
- MileageTransactionì„ MileageTransactionResponseë¡œ ë³€í™˜

**earnMileage(Long userId, Integer amount, MileageTransactionType type, String description, Long orderId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. userIdë¡œ User ì¡°íšŒ (ì—†ìœ¼ë©´ NotFoundException)
2. MileageTransaction Entity ìƒì„±:
   - user, amount (ì–‘ìˆ˜), transactionType, description, orderId ì„¤ì •
   - expiresAt = LocalDateTime.now().plusYears(1) (1ë…„ í›„ ë§Œë£Œ)
3. mileageTransactionRepository.save() í˜¸ì¶œ
4. ë¡œê·¸ ì¶œë ¥: "User {userId} earned {amount} mileage. Type: {type}"
5. @Transactional

**useMileage(Long userId, Integer amount, Long orderId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. getUserMileageBalance() í˜¸ì¶œí•˜ì—¬ í˜„ì¬ ì”ì•¡ í™•ì¸
2. currentBalance < amountì´ë©´ InsufficientMileageException ë°œìƒ
3. userIdë¡œ User ì¡°íšŒ
4. MileageTransaction Entity ìƒì„±:
   - user, amount (ìŒìˆ˜: -amount), transactionType=USE, description, orderId ì„¤ì •
   - expiresAt null (ì‚¬ìš© ë‚´ì—­ì€ ë§Œë£Œ ì—†ìŒ)
5. Repository.save() í˜¸ì¶œ
6. ë¡œê·¸ ì¶œë ¥: "User {userId} used {amount} mileage for order {orderId}"
7. @Transactional

**refundMileage(Long userId, Integer amount, Long orderId): void**

- earnMileage()ë¥¼ í˜¸ì¶œí•˜ì—¬ í™˜ë¶ˆ ì ë¦½ê¸ˆ ì§€ê¸‰
- transactionType: REFUND
- description: "Refund for order #{orderId}"
- ì£¼ë¬¸ ì·¨ì†Œ ì‹œ ì‚¬ìš©í•œ ì ë¦½ê¸ˆì„ ë‹¤ì‹œ ì ë¦½

**expireMileage(): void**

**ì²˜ë¦¬ ë¡œì§:**

1. findExpiredMileage(LocalDateTime.now()) í˜¸ì¶œí•˜ì—¬ ë§Œë£Œëœ ì ë¦½ê¸ˆ ì¡°íšŒ
2. ê° ë§Œë£Œëœ ê±°ë˜ì— ëŒ€í•´:
   - ìƒˆ MileageTransaction ìƒì„±
   - amount = -expired.getAmount() (ë§Œë£Œ ì°¨ê°)
   - transactionType = EXPIRE
   - description = "Expired mileage from {expired.getCreatedAt()}"
   - expiresAt null
   - Repository.save()
3. ë¡œê·¸ ì¶œë ¥: "Expired {count} mileage transactions"
4. @Scheduled(cron = "0 0 1 \* \* \*") - ë§¤ì¼ ìƒˆë²½ 1ì‹œ ì‹¤í–‰
5. @Transactional

**4. MileageController REST API**
ì ë¦½ê¸ˆ ì¡°íšŒ APIë¥¼ ì œê³µí•˜ëŠ” Controllerë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**GET /api/users/mileage/balance - ì ë¦½ê¸ˆ ì”ì•¡ ì¡°íšŒ**

- ì¸ì¦ í•„ìš” (JWT)
- @AuthenticationPrincipal UserPrincipal currentUser ì‚¬ìš©
- mileageService.getUserMileageBalance(currentUser.getId()) í˜¸ì¶œ
- MileageBalanceResponse ìƒì„± ë° ë°˜í™˜
- ApiResponse<MileageBalanceResponse> (200 OK)

**GET /api/users/mileage/history - ì ë¦½ê¸ˆ ë‚´ì—­ ì¡°íšŒ**

- ì¸ì¦ í•„ìš”
- Query Parameters: page (default 0), size (default 20)
- Pageable ìƒì„±
- mileageService.getUserMileageHistory() í˜¸ì¶œ
- ApiResponse<Page<MileageTransactionResponse>> ë°˜í™˜

**5. Response DTO**

**MileageBalanceResponse:**

- balance (Integer) - ì ë¦½ê¸ˆ ì”ì•¡

**MileageTransactionResponse:**

- id (Long)
- amount (Integer)
- transactionType (MileageTransactionType)
- description (String)
- createdAt (LocalDateTime)
- expiresAt (LocalDateTime, nullable)
- static from(MileageTransaction): MileageTransactionResponse ë³€í™˜ ë©”ì„œë“œ

**6. ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤**

- InsufficientMileageException extends RuntimeException
  - "Insufficient mileage balance" ë©”ì‹œì§€

**7. Spring Scheduling í™œì„±í™”**

- Application í´ë˜ìŠ¤ ë˜ëŠ” Config í´ë˜ìŠ¤ì— @EnableScheduling ì¶”ê°€
- expireMileage() ë©”ì„œë“œê°€ ë§¤ì¼ ìƒˆë²½ 1ì‹œ ìë™ ì‹¤í–‰ë¨

**8. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**

- ì ë¦½ê¸ˆì€ ì ë¦½ì¼ë¡œë¶€í„° 1ë…„ í›„ ìë™ ë§Œë£Œ
- ì‚¬ìš© ì‹œ ì”ì•¡ ë¶€ì¡±í•˜ë©´ ê±°ë˜ ê±°ë¶€
- ëª¨ë“  ê±°ë˜ëŠ” Transaction í…Œì´ë¸”ì— ê¸°ë¡ (ë¶ˆë³€ì„±)
- ì”ì•¡ì€ í•­ìƒ SUMìœ¼ë¡œ ê³„ì‚° (ë³„ë„ balance í•„ë“œ ì—†ìŒ)

#### API Endpoints

| Method | Endpoint                   | Description      | Auth Required |
| ------ | -------------------------- | ---------------- | ------------- |
| GET    | /api/users/mileage/balance | ì ë¦½ê¸ˆ ì”ì•¡ ì¡°íšŒ | Yes           |
| GET    | /api/users/mileage/history | ì ë¦½ê¸ˆ ë‚´ì—­ ì¡°íšŒ | Yes           |

#### Error Handling

- ì ë¦½ê¸ˆ ë¶€ì¡±: 400 BAD_REQUEST, "INSUFFICIENT_MILEAGE"
- ì‚¬ìš©ì ì—†ìŒ: 404 NOT_FOUND, "USER_NOT_FOUND"

#### Acceptance Criteria

- [x] GET /api/users/mileage/balance í˜¸ì¶œ ì‹œ í˜„ì¬ ìœ íš¨í•œ ì”ì•¡ ë°˜í™˜
- [x] GET /api/users/mileage/history í˜¸ì¶œ ì‹œ ê±°ë˜ ë‚´ì—­ì´ ìµœì‹ ìˆœìœ¼ë¡œ ë°˜í™˜ë¨
- [x] earnMileage() í˜¸ì¶œ ì‹œ ì ë¦½ê¸ˆì´ ì ë¦½ë˜ê³  expiresAtì´ 1ë…„ í›„ë¡œ ì„¤ì •ë¨
- [x] useMileage() í˜¸ì¶œ ì‹œ ì”ì•¡ ë¶€ì¡±í•˜ë©´ ì˜ˆì™¸ ë°œìƒ
- [x] refundMileage() í˜¸ì¶œ ì‹œ ì ë¦½ê¸ˆì´ ë‹¤ì‹œ ì§€ê¸‰ë¨
- [x] expireMileage() ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ë§¤ì¼ ìƒˆë²½ 1ì‹œ ì‹¤í–‰ë˜ì–´ ë§Œë£Œ ì²˜ë¦¬ë¨
- [x] ëª¨ë“  ê±°ë˜ê°€ í…Œì´ë¸”ì— ê¸°ë¡ë˜ì–´ ì¶”ì  ê°€ëŠ¥

---

### [BE-030] Deposit (ì˜ˆì¹˜ê¸ˆ) Transaction ì‹œìŠ¤í…œ êµ¬í˜„

**Priority**: ğŸ”´ Critical
**Estimated Time**: 6 hours

#### Description

ì˜ˆì¹˜ê¸ˆ ì¶©ì „, ì‚¬ìš©, í™˜ë¶ˆ ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” Transaction ê¸°ë°˜ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤. ì˜ˆì¹˜ê¸ˆì€ ë§Œë£Œê°€ ì—†ìœ¼ë©° ì‚¬ìš©ìê°€ ì–¸ì œë“ ì§€ ì¶©ì „í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Functional Requirements

**1. DepositTransaction Entity ì„¤ê³„**
ë‹¤ìŒ í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” DepositTransaction Entityë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**í•„ë“œ:**

- id (Long, PK, Auto Increment)
- user (User, Many-to-One, NOT NULL, Lazy)
- amount (BigDecimal, precision=10, scale=2, NOT NULL) - ì–‘ìˆ˜: ì¶©ì „, ìŒìˆ˜: ì‚¬ìš©
- transactionType (DepositTransactionType, Enum, NOT NULL)
- description (String, max 255ì)
- orderId (Long, nullable) - ì£¼ë¬¸ ì°¸ì¡° (ì„ íƒ ì‚¬í•­)
- createdAt (BaseEntity ìƒì†)

**DepositTransactionType Enum:**

- CHARGE - ì¶©ì „
- USE - ì‚¬ìš©
- REFUND - í™˜ë¶ˆ

**ì¸ë±ìŠ¤:**

- idx_deposit_transactions_user_id: user_id

**2. DepositTransactionRepository ì¸í„°í˜ì´ìŠ¤**
JpaRepositoryë¥¼ í™•ì¥í•˜ê³  ë‹¤ìŒ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤:

**ì¡°íšŒ ë©”ì„œë“œ:**

- findByUserIdOrderByCreatedAtDesc(Long userId, Pageable pageable): Page<DepositTransaction>

**JPQL ì¿¼ë¦¬:**

- getTotalDepositByUserId(@Param("userId") Long userId): BigDecimal
  - SUM(dt.amount)ë¥¼ ê³„ì‚°í•˜ì—¬ ì‚¬ìš©ìì˜ ì˜ˆì¹˜ê¸ˆ ì”ì•¡ ë°˜í™˜
  - COALESCEë¡œ null ëŒ€ì‹  0 ë°˜í™˜
  - ëª¨ë“  ê±°ë˜ í•©ì‚° (ë§Œë£Œ ì—†ìŒ)

**3. DepositService ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**
ì˜ˆì¹˜ê¸ˆ ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” Serviceë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**getUserDepositBalance(Long userId): BigDecimal**

- ì‚¬ìš©ìì˜ í˜„ì¬ ì˜ˆì¹˜ê¸ˆ ì”ì•¡ ì¡°íšŒ
- Repository.getTotalDepositByUserId() í˜¸ì¶œ
- @Transactional(readOnly = true)

**getUserDepositHistory(Long userId, Pageable pageable): Page<DepositTransactionResponse>**

- ì‚¬ìš©ìì˜ ì˜ˆì¹˜ê¸ˆ ë‚´ì—­ ì¡°íšŒ (í˜ì´ì§€ë„¤ì´ì…˜)
- createdAt ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
- DepositTransactionì„ DepositTransactionResponseë¡œ ë³€í™˜

**chargeDeposit(Long userId, BigDecimal amount, String description): void**

**ì²˜ë¦¬ ë¡œì§:**

1. amount <= 0 ê²€ì¦ (ValidationException ë°œìƒ)
2. userIdë¡œ User ì¡°íšŒ (ì—†ìœ¼ë©´ NotFoundException)
3. DepositTransaction Entity ìƒì„±:
   - user, amount (ì–‘ìˆ˜), transactionType=CHARGE, description ì„¤ì •
4. Repository.save() í˜¸ì¶œ
5. ë¡œê·¸ ì¶œë ¥: "User {userId} charged {amount} deposit"
6. @Transactional

**useDeposit(Long userId, BigDecimal amount, Long orderId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. getUserDepositBalance() í˜¸ì¶œí•˜ì—¬ í˜„ì¬ ì”ì•¡ í™•ì¸
2. currentBalance < amountì´ë©´ InsufficientDepositException ë°œìƒ
3. userIdë¡œ User ì¡°íšŒ
4. DepositTransaction Entity ìƒì„±:
   - user, amount.negate() (ìŒìˆ˜), transactionType=USE, description, orderId ì„¤ì •
5. Repository.save() í˜¸ì¶œ
6. ë¡œê·¸ ì¶œë ¥: "User {userId} used {amount} deposit for order {orderId}"
7. @Transactional

**refundDeposit(Long userId, BigDecimal amount, Long orderId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. userIdë¡œ User ì¡°íšŒ
2. DepositTransaction Entity ìƒì„±:
   - user, amount (ì–‘ìˆ˜), transactionType=REFUND, description, orderId ì„¤ì •
3. Repository.save() í˜¸ì¶œ
4. ë¡œê·¸ ì¶œë ¥: "User {userId} refunded {amount} deposit from order {orderId}"
5. @Transactional

**4. DepositController REST API**
ì˜ˆì¹˜ê¸ˆ ì¡°íšŒ ë° ì¶©ì „ APIë¥¼ ì œê³µí•˜ëŠ” Controllerë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**GET /api/users/deposit/balance - ì˜ˆì¹˜ê¸ˆ ì”ì•¡ ì¡°íšŒ**

- ì¸ì¦ í•„ìš” (JWT)
- @AuthenticationPrincipal UserPrincipal currentUser ì‚¬ìš©
- depositService.getUserDepositBalance(currentUser.getId()) í˜¸ì¶œ
- DepositBalanceResponse ìƒì„± ë° ë°˜í™˜
- ApiResponse<DepositBalanceResponse> (200 OK)

**GET /api/users/deposit/history - ì˜ˆì¹˜ê¸ˆ ë‚´ì—­ ì¡°íšŒ**

- ì¸ì¦ í•„ìš”
- Query Parameters: page (default 0), size (default 20)
- Pageable ìƒì„±
- depositService.getUserDepositHistory() í˜¸ì¶œ
- ApiResponse<Page<DepositTransactionResponse>> ë°˜í™˜

**POST /api/users/deposit/charge - ì˜ˆì¹˜ê¸ˆ ì¶©ì „**

- ì¸ì¦ í•„ìš”
- Request Body: DepositChargeRequest (@Valid ê²€ì¦)
- depositService.chargeDeposit(currentUser.getId(), request.amount, request.description) í˜¸ì¶œ
- ApiResponse<Void> ë°˜í™˜ (200 OK, message: "Deposit charged successfully")

**5. Request/Response DTO**

**DepositChargeRequest:**

- amount (BigDecimal, @NotNull, @DecimalMin("1000.00")) - ìµœì†Œ 1,000ì›
- description (String, optional) - ì¶©ì „ ì„¤ëª…

**DepositBalanceResponse:**

- balance (BigDecimal) - ì˜ˆì¹˜ê¸ˆ ì”ì•¡

**DepositTransactionResponse:**

- id (Long)
- amount (BigDecimal)
- transactionType (DepositTransactionType)
- description (String)
- createdAt (LocalDateTime)
- static from(DepositTransaction): DepositTransactionResponse ë³€í™˜ ë©”ì„œë“œ

**6. ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤**

- InsufficientDepositException extends RuntimeException
  - "Insufficient deposit balance" ë©”ì‹œì§€

**7. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**

- ì˜ˆì¹˜ê¸ˆì€ ë§Œë£Œ ì—†ìŒ (ì ë¦½ê¸ˆê³¼ ì°¨ì´ì )
- ì¶©ì „ ìµœì†Œ ê¸ˆì•¡: 1,000ì›
- ì‚¬ìš© ì‹œ ì”ì•¡ ë¶€ì¡±í•˜ë©´ ê±°ë˜ ê±°ë¶€
- ëª¨ë“  ê±°ë˜ëŠ” Transaction í…Œì´ë¸”ì— ê¸°ë¡
- ì”ì•¡ì€ í•­ìƒ SUMìœ¼ë¡œ ê³„ì‚°

**8. í–¥í›„ í™•ì¥ (Week 22-25)**

- ì‹¤ì œ ê²°ì œ PG ì—°ë™í•˜ì—¬ ì˜ˆì¹˜ê¸ˆ ì¶©ì „
- í˜„ì¬ëŠ” ìˆ˜ë™ ì¶©ì „ (ê´€ë¦¬ìê°€ ìŠ¹ì¸í•˜ê±°ë‚˜ Stub)

#### API Endpoints

| Method | Endpoint                   | Description      | Auth Required |
| ------ | -------------------------- | ---------------- | ------------- |
| GET    | /api/users/deposit/balance | ì˜ˆì¹˜ê¸ˆ ì”ì•¡ ì¡°íšŒ | Yes           |
| GET    | /api/users/deposit/history | ì˜ˆì¹˜ê¸ˆ ë‚´ì—­ ì¡°íšŒ | Yes           |
| POST   | /api/users/deposit/charge  | ì˜ˆì¹˜ê¸ˆ ì¶©ì „      | Yes           |

#### Error Handling

- ì˜ˆì¹˜ê¸ˆ ë¶€ì¡±: 400 BAD_REQUEST, "INSUFFICIENT_DEPOSIT"
- ì¶©ì „ ê¸ˆì•¡ ë¶€ì ì ˆ: 400 BAD_REQUEST, "VALIDATION_ERROR"
- ì‚¬ìš©ì ì—†ìŒ: 404 NOT_FOUND, "USER_NOT_FOUND"

#### Acceptance Criteria

- [x] GET /api/users/deposit/balance í˜¸ì¶œ ì‹œ í˜„ì¬ ì”ì•¡ ë°˜í™˜
- [x] GET /api/users/deposit/history í˜¸ì¶œ ì‹œ ê±°ë˜ ë‚´ì—­ì´ ìµœì‹ ìˆœìœ¼ë¡œ ë°˜í™˜ë¨
- [x] POST /api/users/deposit/charge í˜¸ì¶œ ì‹œ ì˜ˆì¹˜ê¸ˆì´ ì¶©ì „ë¨
- [x] chargeDeposit() í˜¸ì¶œ ì‹œ ê¸ˆì•¡ì´ 1,000ì› ë¯¸ë§Œì´ë©´ ì˜ˆì™¸ ë°œìƒ
- [x] useDeposit() í˜¸ì¶œ ì‹œ ì”ì•¡ ë¶€ì¡±í•˜ë©´ ì˜ˆì™¸ ë°œìƒ
- [x] refundDeposit() í˜¸ì¶œ ì‹œ ì˜ˆì¹˜ê¸ˆì´ ë‹¤ì‹œ ì§€ê¸‰ë¨
- [x] ëª¨ë“  ê±°ë˜ê°€ í…Œì´ë¸”ì— ê¸°ë¡ë˜ì–´ ì¶”ì  ê°€ëŠ¥

---

### [BE-031] Coupon Entity ë° ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„

**Priority**: ğŸŸ¡ High
**Estimated Time**: 10 hours

#### Description

ì¿ í° ìƒì„±, ë°œê¸‰, ì‚¬ìš©, ë§Œë£Œ ê´€ë¦¬ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤. ì¿ í°ì€ ê´€ë¦¬ìê°€ ìƒì„±í•˜ê³  ì‚¬ìš©ìì—ê²Œ ë°œê¸‰í•˜ë©°, ì‚¬ìš©ìëŠ” ì£¼ë¬¸ ì‹œ ì¿ í°ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### Functional Requirements

**1. Coupon Entity ì„¤ê³„**
ë‹¤ìŒ í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” Coupon Entityë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**í•„ë“œ:**

- id (Long, PK, Auto Increment)
- code (String, UNIQUE, NOT NULL, max 50ì) - ì¿ í° ì½”ë“œ (ì˜ˆ: "WELCOME2024")
- name (String, NOT NULL, max 100ì) - ì¿ í° ì´ë¦„
- description (TEXT) - ì¿ í° ì„¤ëª…
- discountType (DiscountType, Enum, NOT NULL) - í• ì¸ ìœ í˜•
- discountValue (BigDecimal, precision=10, scale=2, NOT NULL) - í• ì¸ ê°’
- minOrderAmount (BigDecimal, precision=10, scale=2, nullable) - ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡
- maxDiscountAmount (BigDecimal, precision=10, scale=2, nullable) - ìµœëŒ€ í• ì¸ ê¸ˆì•¡
- issuedCount (Integer, default 0) - ë°œê¸‰ëœ ìˆ˜
- usedCount (Integer, default 0) - ì‚¬ìš©ëœ ìˆ˜
- maxIssueCount (Integer, nullable) - ìµœëŒ€ ë°œê¸‰ ê°€ëŠ¥ ìˆ˜
- startsAt (LocalDateTime, NOT NULL) - ì‚¬ìš© ê°€ëŠ¥ ì‹œì‘ì¼
- expiresAt (LocalDateTime, NOT NULL) - ë§Œë£Œì¼
- isActive (Boolean, default true) - í™œì„± ìƒíƒœ
- createdAt, updatedAt (BaseEntity ìƒì†)

**DiscountType Enum:**

- FIXED_AMOUNT - ê³ ì • ê¸ˆì•¡ í• ì¸ (ì˜ˆ: 5,000ì›)
- PERCENTAGE - ë¹„ìœ¨ í• ì¸ (ì˜ˆ: 10%)

**ì¸ë±ìŠ¤:**

- idx_coupons_code: code (UNIQUE)
- idx_coupons_is_active: is_active

**2. UserCoupon Entity ì„¤ê³„**
ì‚¬ìš©ìë³„ ì¿ í° ë°œê¸‰ ë‚´ì—­ì„ ê´€ë¦¬í•˜ëŠ” Entityë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**í•„ë“œ:**

- id (Long, PK, Auto Increment)
- user (User, Many-to-One, NOT NULL, Lazy)
- coupon (Coupon, Many-to-One, NOT NULL, Lazy)
- isUsed (Boolean, default false) - ì‚¬ìš© ì—¬ë¶€
- usedAt (LocalDateTime, nullable) - ì‚¬ìš© ì¼ì‹œ
- orderId (Long, nullable) - ì‚¬ìš©ëœ ì£¼ë¬¸ ID
- createdAt (BaseEntity ìƒì†)

**ë³µí•© UNIQUE ì œì•½:**

- (user_id, coupon_id) - í•œ ì‚¬ìš©ìê°€ ë™ì¼í•œ ì¿ í°ì„ ì¤‘ë³µ ë°œê¸‰ë°›ì§€ ëª»í•¨

**ì¸ë±ìŠ¤:**

- idx_user_coupons_user_id: user_id
- idx_user_coupons_coupon_id: coupon_id

**3. CouponRepository ì¸í„°í˜ì´ìŠ¤**
JpaRepositoryë¥¼ í™•ì¥í•˜ê³  ë‹¤ìŒ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤:

**ì¡°íšŒ ë©”ì„œë“œ:**

- findByCode(String code): Optional<Coupon>
- findByIsActiveTrueAndStartsAtBeforeAndExpiresAtAfter(LocalDateTime now1, LocalDateTime now2): List<Coupon>
  - í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í° ëª©ë¡ ì¡°íšŒ

**4. UserCouponRepository ì¸í„°í˜ì´ìŠ¤**
JpaRepositoryë¥¼ í™•ì¥í•˜ê³  ë‹¤ìŒ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤:

**ì¡°íšŒ ë©”ì„œë“œ:**

- findByUserId(Long userId): List<UserCoupon>
- findByUserIdAndIsUsedFalse(Long userId): List<UserCoupon>
- findByUserIdAndCouponId(Long userId, Long couponId): Optional<UserCoupon>
- existsByUserIdAndCouponId(Long userId, Long couponId): boolean

**5. CouponService ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**
ì¿ í° ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” Serviceë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**getAvailableCoupons(): List<CouponResponse>**

- í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í° ëª©ë¡ ì¡°íšŒ
- startsAt <= now <= expiresAt AND isActive = true
- Couponì„ CouponResponseë¡œ ë³€í™˜
- @Transactional(readOnly = true)

**getCouponByCode(String code): CouponResponse**

- codeë¡œ ì¿ í° ì¡°íšŒ
- ì¿ í° ì—†ìŒ ì‹œ NotFoundException ë°œìƒ

**issueCoupon(Long userId, String couponCode): void**

**ì²˜ë¦¬ ë¡œì§:**

1. couponCodeë¡œ Coupon ì¡°íšŒ (ì—†ìœ¼ë©´ NotFoundException)
2. ì¿ í° ìœ íš¨ì„± ê²€ì¦:
   - isActive = true í™•ì¸
   - startsAt <= now <= expiresAt í™•ì¸
   - maxIssueCount ì²´í¬ (ì„¤ì •ëœ ê²½ìš°): issuedCount < maxIssueCount
3. ì¤‘ë³µ ë°œê¸‰ í™•ì¸: existsByUserIdAndCouponId() í˜¸ì¶œ
   - ì´ë¯¸ ë°œê¸‰ëœ ê²½ìš° DuplicateCouponException ë°œìƒ
4. userIdë¡œ User ì¡°íšŒ
5. UserCoupon Entity ìƒì„±:
   - user, coupon ì„¤ì •
   - isUsed = false
6. userCouponRepository.save() í˜¸ì¶œ
7. coupon.issuedCount ì¦ê°€ (Coupon Entity ì—…ë°ì´íŠ¸)
8. @Transactional

**getUserCoupons(Long userId): List<UserCouponResponse>**

- ì‚¬ìš©ìì˜ ëª¨ë“  ì¿ í° ì¡°íšŒ (ì‚¬ìš©/ë¯¸ì‚¬ìš© í¬í•¨)
- findByUserId() í˜¸ì¶œ
- UserCouponì„ UserCouponResponseë¡œ ë³€í™˜

**getUserAvailableCoupons(Long userId): List<UserCouponResponse>**

- ì‚¬ìš©ìì˜ ë¯¸ì‚¬ìš© ì¿ í°ë§Œ ì¡°íšŒ
- findByUserIdAndIsUsedFalse() í˜¸ì¶œ
- ë§Œë£Œë˜ì§€ ì•Šì€ ì¿ í°ë§Œ í•„í„°ë§ (coupon.expiresAt > now)

**useCoupon(Long userId, Long userCouponId, Long orderId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. userCouponIdë¡œ UserCoupon ì¡°íšŒ (ì—†ìœ¼ë©´ NotFoundException)
2. ì†Œìœ ê¶Œ í™•ì¸: userCoupon.user.id == userId
   - ë¶ˆì¼ì¹˜ ì‹œ ForbiddenException ë°œìƒ
3. ì´ë¯¸ ì‚¬ìš© í™•ì¸: isUsed = trueì´ë©´ CouponAlreadyUsedException ë°œìƒ
4. ì¿ í° ë§Œë£Œ í™•ì¸: coupon.expiresAt < nowì´ë©´ CouponExpiredException ë°œìƒ
5. userCoupon ì—…ë°ì´íŠ¸:
   - isUsed = true
   - usedAt = LocalDateTime.now()
   - orderId ì„¤ì •
6. coupon.usedCount ì¦ê°€
7. @Transactional

**calculateDiscount(Coupon coupon, BigDecimal orderAmount): BigDecimal**

**ì²˜ë¦¬ ë¡œì§:**

1. minOrderAmount í™•ì¸: orderAmount < minOrderAmountì´ë©´ 0 ë°˜í™˜
2. discountTypeì— ë”°ë¼ í• ì¸ ê¸ˆì•¡ ê³„ì‚°:
   - FIXED_AMOUNT: discountValue ê·¸ëŒ€ë¡œ ì‚¬ìš©
   - PERCENTAGE: orderAmount \* (discountValue / 100)
3. maxDiscountAmount ì ìš© (ì„¤ì •ëœ ê²½ìš°):
   - ê³„ì‚°ëœ í• ì¸ ê¸ˆì•¡ì´ maxDiscountAmountë¥¼ ì´ˆê³¼í•˜ë©´ ì œí•œ
4. í• ì¸ ê¸ˆì•¡ ë°˜í™˜

**6. CouponController REST API**
ì¿ í° ì¡°íšŒ ë° ë°œê¸‰ APIë¥¼ ì œê³µí•˜ëŠ” Controllerë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**GET /api/coupons - ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í° ëª©ë¡ ì¡°íšŒ**

- ì¸ì¦ ë¶ˆí•„ìš” (public)
- couponService.getAvailableCoupons() í˜¸ì¶œ
- ApiResponse<List<CouponResponse>> ë°˜í™˜

**POST /api/coupons/issue - ì¿ í° ë°œê¸‰**

- ì¸ì¦ í•„ìš”
- Request Body: CouponIssueRequest (couponCode)
- couponService.issueCoupon(currentUser.getId(), request.couponCode) í˜¸ì¶œ
- ApiResponse<Void> ë°˜í™˜ (200 OK, message: "Coupon issued successfully")

**GET /api/users/coupons - ë‚´ ì¿ í° ëª©ë¡ ì¡°íšŒ**

- ì¸ì¦ í•„ìš”
- Query Parameter: onlyAvailable (Boolean, default: false)
- onlyAvailable = trueì´ë©´ getUserAvailableCoupons() í˜¸ì¶œ
- ì•„ë‹ˆë©´ getUserCoupons() í˜¸ì¶œ
- ApiResponse<List<UserCouponResponse>> ë°˜í™˜

**7. Request/Response DTO**

**CouponIssueRequest:**

- couponCode (String, @NotBlank)

**CouponResponse:**

- id, code, name, description
- discountType, discountValue
- minOrderAmount, maxDiscountAmount
- issuedCount, usedCount, maxIssueCount
- startsAt, expiresAt
- static from(Coupon): CouponResponse ë³€í™˜ ë©”ì„œë“œ

**UserCouponResponse:**

- id
- coupon (CouponResponse) - ì¿ í° ì •ë³´
- isUsed, usedAt
- createdAt
- static from(UserCoupon): UserCouponResponse ë³€í™˜ ë©”ì„œë“œ

**8. ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤**

- DuplicateCouponException - "Coupon already issued to this user"
- CouponAlreadyUsedException - "Coupon already used"
- CouponExpiredException - "Coupon has expired"
- CouponNotAvailableException - "Coupon is not available"
- MaxIssueExceededException - "Coupon issue limit exceeded"

**9. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**

- í•œ ì‚¬ìš©ìëŠ” ë™ì¼í•œ ì¿ í°ì„ 1ë²ˆë§Œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŒ
- ì¿ í°ì€ ë°œê¸‰ í›„ ë§Œë£Œì¼ê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥
- ì¿ í° ì‚¬ìš© ì‹œ ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ ì¡°ê±´ í™•ì¸
- í• ì¸ ê¸ˆì•¡ì€ ìµœëŒ€ í• ì¸ ê¸ˆì•¡ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŒ
- ì¿ í°ì€ ì£¼ë¬¸ë‹¹ 1ê°œë§Œ ì‚¬ìš© ê°€ëŠ¥ (ì£¼ë¬¸ ë¡œì§ì—ì„œ ì²˜ë¦¬)

#### API Endpoints

| Method | Endpoint           | Description           | Auth Required |
| ------ | ------------------ | --------------------- | ------------- |
| GET    | /api/coupons       | ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í° ëª©ë¡ | No            |
| POST   | /api/coupons/issue | ì¿ í° ë°œê¸‰             | Yes           |
| GET    | /api/users/coupons | ë‚´ ì¿ í° ëª©ë¡ ì¡°íšŒ     | Yes           |

#### Error Handling

- ì¿ í° ì—†ìŒ: 404 NOT_FOUND, "COUPON_NOT_FOUND"
- ì¤‘ë³µ ë°œê¸‰: 409 CONFLICT, "DUPLICATE_COUPON"
- ì´ë¯¸ ì‚¬ìš©: 400 BAD_REQUEST, "COUPON_ALREADY_USED"
- ì¿ í° ë§Œë£Œ: 400 BAD_REQUEST, "COUPON_EXPIRED"
- ë°œê¸‰ í•œë„ ì´ˆê³¼: 400 BAD_REQUEST, "MAX_ISSUE_EXCEEDED"

#### Acceptance Criteria

- [x] GET /api/coupons í˜¸ì¶œ ì‹œ í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í° ëª©ë¡ ë°˜í™˜
- [x] POST /api/coupons/issue í˜¸ì¶œ ì‹œ ì¿ í°ì´ ì‚¬ìš©ìì—ê²Œ ë°œê¸‰ë¨
- [x] ë™ì¼í•œ ì¿ í° ì¤‘ë³µ ë°œê¸‰ ì‹œ ì˜ˆì™¸ ë°œìƒ
- [x] GET /api/users/coupons í˜¸ì¶œ ì‹œ ì‚¬ìš©ìì˜ ì¿ í° ëª©ë¡ ë°˜í™˜
- [x] onlyAvailable=true ì‹œ ë¯¸ì‚¬ìš© ì¿ í°ë§Œ ë°˜í™˜
- [x] useCoupon() í˜¸ì¶œ ì‹œ ì¿ í°ì´ ì‚¬ìš© ì²˜ë¦¬ë¨
- [x] calculateDiscount() í˜¸ì¶œ ì‹œ ì˜¬ë°”ë¥¸ í• ì¸ ê¸ˆì•¡ ê³„ì‚°ë¨
- [x] ìµœì†Œ ì£¼ë¬¸ ê¸ˆì•¡ ë¯¸ë‹¬ ì‹œ í• ì¸ ê¸ˆì•¡ 0 ë°˜í™˜
- [x] ìµœëŒ€ í• ì¸ ê¸ˆì•¡ ì œí•œì´ ì ìš©ë¨

---

### [BE-032] Wishlist (ìœ„ì‹œë¦¬ìŠ¤íŠ¸) Entity ë° API êµ¬í˜„

**Priority**: ğŸŸ¡ High
**Estimated Time**: 6 hours

#### Description

ì‚¬ìš©ìê°€ ìƒí’ˆì„ ì°œ(ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€)í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì—ì„œ ìƒí’ˆ ì¶”ê°€, ì‚­ì œ, ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

#### Functional Requirements

**1. Wishlist Entity ì„¤ê³„**
ë‹¤ìŒ í•„ë“œë¥¼ í¬í•¨í•˜ëŠ” Wishlist Entityë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**í•„ë“œ:**

- id (Long, PK, Auto Increment)
- user (User, Many-to-One, NOT NULL, Lazy)
- product (Product, Many-to-One, NOT NULL, Lazy)
- createdAt (BaseEntity ìƒì†)

**ë³µí•© UNIQUE ì œì•½:**

- (user_id, product_id) - í•œ ì‚¬ìš©ìê°€ ë™ì¼í•œ ìƒí’ˆì„ ì¤‘ë³µ ì¶”ê°€ ëª»í•¨

**ì¸ë±ìŠ¤:**

- idx_wishlist_user_id: user_id
- idx_wishlist_product_id: product_id

**2. WishlistRepository ì¸í„°í˜ì´ìŠ¤**
JpaRepositoryë¥¼ í™•ì¥í•˜ê³  ë‹¤ìŒ ì¿¼ë¦¬ ë©”ì„œë“œë¥¼ ì •ì˜í•©ë‹ˆë‹¤:

**ì¡°íšŒ ë©”ì„œë“œ:**

- findByUserId(Long userId): List<Wishlist>
- findByUserIdAndProductId(Long userId, Long productId): Optional<Wishlist>
- existsByUserIdAndProductId(Long userId, Long productId): boolean
- countByUserId(Long userId): Long

**JPQL ì¿¼ë¦¬ (N+1 ë°©ì§€):**

- findByUserIdWithProduct(@Param("userId") Long userId): List<Wishlist>
  - LEFT JOIN FETCH wishlist.product
  - LEFT JOIN FETCH product.images
  - user.id = userId AND product.isActive = true
  - ORDER BY wishlist.createdAt DESC

**3. WishlistService ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**
ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” Serviceë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**getUserWishlist(Long userId): List<WishlistResponse>**

- ì‚¬ìš©ìì˜ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
- findByUserIdWithProduct() í˜¸ì¶œ (N+1 ë°©ì§€)
- Wishlistë¥¼ WishlistResponseë¡œ ë³€í™˜
- ìƒí’ˆì´ ë¹„í™œì„±í™”ë˜ë©´ ì œì™¸
- @Transactional(readOnly = true)

**addToWishlist(Long userId, Long productId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. ì¤‘ë³µ í™•ì¸: existsByUserIdAndProductId() í˜¸ì¶œ
   - ì´ë¯¸ ì¶”ê°€ëœ ê²½ìš° DuplicateWishlistException ë°œìƒ
2. productIdë¡œ Product ì¡°íšŒ (ì—†ìœ¼ë©´ NotFoundException)
3. product.isActive í™•ì¸ (ë¹„í™œì„±í™”ë©´ ì˜ˆì™¸ ë°œìƒ)
4. userIdë¡œ User ì¡°íšŒ
5. Wishlist Entity ìƒì„±:
   - user, product ì„¤ì •
6. wishlistRepository.save() í˜¸ì¶œ
7. @Transactional

**removeFromWishlist(Long userId, Long productId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. findByUserIdAndProductId() í˜¸ì¶œ
2. Wishlist ì—†ìŒ ì‹œ NotFoundException ë°œìƒ
3. wishlistRepository.delete(wishlist) í˜¸ì¶œ
4. @Transactional

**isInWishlist(Long userId, Long productId): boolean**

- existsByUserIdAndProductId() í˜¸ì¶œ
- true/false ë°˜í™˜

**getWishlistCount(Long userId): Long**

- countByUserId() í˜¸ì¶œ
- ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì´ ê°œìˆ˜ ë°˜í™˜

**4. WishlistController REST API**
ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ APIë¥¼ ì œê³µí•˜ëŠ” Controllerë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**GET /api/users/wishlist - ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¡°íšŒ**

- ì¸ì¦ í•„ìš”
- wishlistService.getUserWishlist(currentUser.getId()) í˜¸ì¶œ
- ApiResponse<List<WishlistResponse>> ë°˜í™˜

**POST /api/users/wishlist - ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ìƒí’ˆ ì¶”ê°€**

- ì¸ì¦ í•„ìš”
- Request Body: WishlistAddRequest (productId)
- wishlistService.addToWishlist(currentUser.getId(), request.productId) í˜¸ì¶œ
- ApiResponse<Void> ë°˜í™˜ (200 OK, message: "Added to wishlist")

**DELETE /api/users/wishlist/{productId} - ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì—ì„œ ìƒí’ˆ ì œê±°**

- ì¸ì¦ í•„ìš”
- Path Variable: productId (Long)
- wishlistService.removeFromWishlist(currentUser.getId(), productId) í˜¸ì¶œ
- ApiResponse<Void> ë°˜í™˜ (200 OK, message: "Removed from wishlist")

**GET /api/users/wishlist/check/{productId} - ìœ„ì‹œë¦¬ìŠ¤íŠ¸ í¬í•¨ ì—¬ë¶€ í™•ì¸**

- ì¸ì¦ í•„ìš”
- Path Variable: productId (Long)
- wishlistService.isInWishlist(currentUser.getId(), productId) í˜¸ì¶œ
- ApiResponse<WishlistCheckResponse> ë°˜í™˜ (isInWishlist: true/false)

**GET /api/users/wishlist/count - ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ ì¡°íšŒ**

- ì¸ì¦ í•„ìš”
- wishlistService.getWishlistCount(currentUser.getId()) í˜¸ì¶œ
- ApiResponse<WishlistCountResponse> ë°˜í™˜ (count: Long)

**5. Request/Response DTO**

**WishlistAddRequest:**

- productId (Long, @NotNull)

**WishlistResponse:**

- id
- product (ProductResponse) - ìƒí’ˆ ì •ë³´ ì „ì²´ (ì´ë¯¸ì§€ í¬í•¨)
- createdAt
- static from(Wishlist): WishlistResponse ë³€í™˜ ë©”ì„œë“œ

**WishlistCheckResponse:**

- isInWishlist (boolean)

**WishlistCountResponse:**

- count (Long)

**6. ì»¤ìŠ¤í…€ ì˜ˆì™¸ í´ë˜ìŠ¤**

- DuplicateWishlistException - "Product already in wishlist"

**7. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**

- í•œ ì‚¬ìš©ìëŠ” ë™ì¼í•œ ìƒí’ˆì„ 1ë²ˆë§Œ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ ê°€ëŠ¥
- ë¹„í™œì„±í™”ëœ ìƒí’ˆì€ ì¶”ê°€ ë¶ˆê°€
- ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì‹œ ë¹„í™œì„±í™”ëœ ìƒí’ˆì€ ì œì™¸
- ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ ì œí•œ ì—†ìŒ

#### API Endpoints

| Method | Endpoint                              | Description              | Auth Required |
| ------ | ------------------------------------- | ------------------------ | ------------- |
| GET    | /api/users/wishlist                   | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¡°íšŒ          | Yes           |
| POST   | /api/users/wishlist                   | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ìƒí’ˆ ì¶”ê°€   | Yes           |
| DELETE | /api/users/wishlist/{productId}       | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì—ì„œ ìƒí’ˆ ì œê±° | Yes           |
| GET    | /api/users/wishlist/check/{productId} | í¬í•¨ ì—¬ë¶€ í™•ì¸           | Yes           |
| GET    | /api/users/wishlist/count             | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ ì¡°íšŒ     | Yes           |

#### Error Handling

- ìƒí’ˆ ì—†ìŒ: 404 NOT_FOUND, "PRODUCT_NOT_FOUND"
- ì¤‘ë³µ ì¶”ê°€: 409 CONFLICT, "DUPLICATE_WISHLIST"
- ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì—†ìŒ: 404 NOT_FOUND, "WISHLIST_NOT_FOUND"

#### Acceptance Criteria

- [x] GET /api/users/wishlist í˜¸ì¶œ ì‹œ ì‚¬ìš©ìì˜ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ìƒí’ˆ ëª©ë¡ ë°˜í™˜
- [x] POST /api/users/wishlist í˜¸ì¶œ ì‹œ ìƒí’ˆì´ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë¨
- [x] ì¤‘ë³µ ì¶”ê°€ ì‹œë„ ì‹œ 409 ì—ëŸ¬ ë°˜í™˜
- [x] DELETE /api/users/wishlist/{productId} í˜¸ì¶œ ì‹œ í•´ë‹¹ ìƒí’ˆ ì œê±°ë¨
- [x] GET /api/users/wishlist/check/{productId} í˜¸ì¶œ ì‹œ í¬í•¨ ì—¬ë¶€ ë°˜í™˜
- [x] GET /api/users/wishlist/count í˜¸ì¶œ ì‹œ ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ ë°˜í™˜
- [x] N+1 ë¬¸ì œ ì—†ì´ JOIN FETCHë¡œ í•œ ë²ˆì— ì¡°íšŒë¨

---

### [BE-033] íšŒì› ë“±ê¸‰ (Membership Tier) ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„

**Priority**: ğŸŸ¢ Medium
**Estimated Time**: 6 hours

#### Description

íšŒì› ë“±ê¸‰(BASIC, VIP, WHOLESALE)ì— ë”°ë¼ ë‹¤ë¥¸ í˜œíƒì„ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤. ê° ë“±ê¸‰ë³„ë¡œ í• ì¸ìœ¨, ë°°ì†¡ë¹„, ì ë¦½ë¥ ì´ ë‹¤ë¦…ë‹ˆë‹¤.

#### Functional Requirements

**1. MembershipTier Enum (User Entityì— ì´ë¯¸ ì¡´ì¬)**
User Entityì˜ membershipTier í•„ë“œë¥¼ í™œìš©í•©ë‹ˆë‹¤:

- BASIC - ì¼ë°˜ íšŒì›
- VIP - VIP íšŒì› (êµ¬ë§¤ ê¸ˆì•¡ ê¸°ì¤€ ìë™ ìŠ¹ê¸‰)
- WHOLESALE - ë„ë§¤ íšŒì› (ë³„ë„ ìŠ¹ì¸ í•„ìš”)

**2. MembershipConfig í´ë˜ìŠ¤ (or application.yml)**
ê° ë“±ê¸‰ë³„ í˜œíƒì„ ì •ì˜í•˜ëŠ” Configuration í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**ë“±ê¸‰ë³„ ì„¤ì •:**

**BASIC (ì¼ë°˜ íšŒì›):**

- ì ë¦½ë¥ : 1%
- ë°°ì†¡ë¹„: 3,000ì› (50,000ì› ì´ìƒ ë¬´ë£Œ)
- ë„ë§¤ê°€ ì—´ëŒ: ë¶ˆê°€
- ì¿ í° ë°œê¸‰: ì œí•œì 

**VIP (VIP íšŒì›):**

- ì ë¦½ë¥ : 3%
- ë°°ì†¡ë¹„: 2,000ì› (30,000ì› ì´ìƒ ë¬´ë£Œ)
- ë„ë§¤ê°€ ì—´ëŒ: ë¶ˆê°€
- ì¿ í° ë°œê¸‰: ìš°ì„  ë°œê¸‰

**WHOLESALE (ë„ë§¤ íšŒì›):**

- ì ë¦½ë¥ : 0.5% (ë‚®ì§€ë§Œ ë„ë§¤ê°€ ì œê³µ)
- ë°°ì†¡ë¹„: 5,000ì› (100,000ì› ì´ìƒ ë¬´ë£Œ)
- ë„ë§¤ê°€ ì—´ëŒ: ê°€ëŠ¥
- ì¿ í° ë°œê¸‰: ì œí•œì 

**Configuration í´ë˜ìŠ¤ êµ¬í˜„:**

- @ConfigurationProperties ë˜ëŠ” Enumì— ì§ì ‘ ì •ì˜
- getMileageRate(MembershipTier tier): BigDecimal
- getShippingFee(MembershipTier tier): BigDecimal
- getFreeShippingThreshold(MembershipTier tier): BigDecimal
- canViewWholesalePrice(MembershipTier tier): boolean

**3. MembershipService ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**
íšŒì› ë“±ê¸‰ ê´€ë ¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” Serviceë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**getUserTier(Long userId): MembershipTier**

- userIdë¡œ User ì¡°íšŒ
- user.getMembershipTier() ë°˜í™˜

**upgr adeToVIP(Long userId): void**

**ì²˜ë¦¬ ë¡œì§:**

1. userIdë¡œ User ì¡°íšŒ
2. í˜„ì¬ ë“±ê¸‰ì´ VIP ì´ìƒì´ë©´ skip
3. VIP ìŠ¹ê¸‰ ì¡°ê±´ í™•ì¸:
   - ìµœê·¼ 1ë…„ê°„ êµ¬ë§¤ ê¸ˆì•¡ í•©ê³„ ê³„ì‚° (Order í…Œì´ë¸” ì¡°íšŒ)
   - ì´ êµ¬ë§¤ ê¸ˆì•¡ >= 1,000,000ì›ì´ë©´ ìŠ¹ê¸‰ ê°€ëŠ¥
4. user.setMembershipTier(VIP)
5. ìŠ¹ê¸‰ ì•Œë¦¼ (ë¡œê·¸ ë˜ëŠ” ì´ë©”ì¼, Week 22-25ì—ì„œ êµ¬í˜„)
6. @Transactional

**requestWholesale(Long userId, String businessLicense): void**

**ì²˜ë¦¬ ë¡œì§:**

1. userIdë¡œ User ì¡°íšŒ
2. ë„ë§¤ íšŒì› ì‹ ì²­ ë‚´ì—­ ì €ì¥ (ë³„ë„ í…Œì´ë¸” ë˜ëŠ” User í•„ë“œ)
3. businessLicense ì •ë³´ ì €ì¥ (ì‚¬ì—…ì ë“±ë¡ì¦ ë²ˆí˜¸)
4. ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸° ìƒíƒœë¡œ ì„¤ì •
5. @Transactional

**Note**: í˜„ì¬ëŠ” Stub êµ¬í˜„, ì‹¤ì œ ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ëŠ” ê´€ë¦¬ì ê¸°ëŠ¥ì—ì„œ ì²˜ë¦¬

**calculateMileage(MembershipTier tier, BigDecimal orderAmount): Integer**

- getMileageRate() í˜¸ì¶œí•˜ì—¬ ì ë¦½ë¥  ì¡°íšŒ
- orderAmount \* mileageRate ê³„ì‚°
- Integerë¡œ ë°˜ì˜¬ë¦¼í•˜ì—¬ ë°˜í™˜

**calculateShippingFee(MembershipTier tier, BigDecimal orderAmount): BigDecimal**

- getFreeShippingThreshold() í˜¸ì¶œ
- orderAmount >= thresholdì´ë©´ 0 ë°˜í™˜ (ë¬´ë£Œ ë°°ì†¡)
- ì•„ë‹ˆë©´ getShippingFee() ë°˜í™˜

**4. MembershipController REST API**
íšŒì› ë“±ê¸‰ ì¡°íšŒ ë° ì‹ ì²­ APIë¥¼ ì œê³µí•˜ëŠ” Controllerë¥¼ ì‘ì„±í•©ë‹ˆë‹¤:

**GET /api/users/membership - ë‚´ ë“±ê¸‰ ì •ë³´ ì¡°íšŒ**

- ì¸ì¦ í•„ìš”
- membershipService.getUserTier(currentUser.getId()) í˜¸ì¶œ
- MembershipConfigì—ì„œ ë“±ê¸‰ë³„ í˜œíƒ ì •ë³´ ì¡°íšŒ
- ApiResponse<MembershipInfoResponse> ë°˜í™˜

**POST /api/users/membership/wholesale - ë„ë§¤ íšŒì› ì‹ ì²­**

- ì¸ì¦ í•„ìš”
- Request Body: WholesaleRequest (businessLicense)
- membershipService.requestWholesale(currentUser.getId(), request.businessLicense) í˜¸ì¶œ
- ApiResponse<Void> ë°˜í™˜ (200 OK, message: "Wholesale membership requested")

**5. Response DTO**

**MembershipInfoResponse:**

- tier (MembershipTier) - í˜„ì¬ ë“±ê¸‰
- mileageRate (BigDecimal) - ì ë¦½ë¥ 
- shippingFee (BigDecimal) - ê¸°ë³¸ ë°°ì†¡ë¹„
- freeShippingThreshold (BigDecimal) - ë¬´ë£Œ ë°°ì†¡ ê¸°ì¤€ ê¸ˆì•¡
- canViewWholesalePrice (boolean) - ë„ë§¤ê°€ ì—´ëŒ ê°€ëŠ¥ ì—¬ë¶€

**WholesaleRequest:**

- businessLicense (String, @NotBlank) - ì‚¬ì—…ì ë“±ë¡ì¦ ë²ˆí˜¸

**6. ìë™ ìŠ¹ê¸‰ ìŠ¤ì¼€ì¤„ëŸ¬ (ì„ íƒ ì‚¬í•­)**
ë§¤ì¼ ìì •ì— VIP ìŠ¹ê¸‰ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì‚¬ìš©ìë¥¼ ìë™ ìŠ¹ê¸‰:

**autoUpgradeToVIP(): void**

- ëª¨ë“  BASIC íšŒì› ì¡°íšŒ
- ê° íšŒì›ì˜ ìµœê·¼ 1ë…„ êµ¬ë§¤ ê¸ˆì•¡ í•©ê³„ ê³„ì‚°
- 1,000,000ì› ì´ìƒì´ë©´ upgradeToVIP() í˜¸ì¶œ
- @Scheduled(cron = "0 0 0 \* \* \*") - ë§¤ì¼ ìì • ì‹¤í–‰
- @Transactional

**7. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™**

- BASIC â†’ VIP: ìµœê·¼ 1ë…„ê°„ 100ë§Œì› ì´ìƒ êµ¬ë§¤ ì‹œ ìë™ ìŠ¹ê¸‰
- BASIC/VIP â†’ WHOLESALE: ë³„ë„ ì‹ ì²­ ë° ê´€ë¦¬ì ìŠ¹ì¸ í•„ìš”
- WHOLESALE â†’ VIP/BASIC: ê°•ë“± ë¶ˆê°€ (ê´€ë¦¬ìë§Œ ë³€ê²½ ê°€ëŠ¥)
- ë„ë§¤ íšŒì›ì€ ë„ë§¤ê°€ë¡œ êµ¬ë§¤ ê°€ëŠ¥ (Product.wholesalePrice ì‚¬ìš©)

**8. ìƒí’ˆ ê°€ê²© ê²°ì • ë¡œì§ (ProductServiceì— ì¶”ê°€)**
getCurrentPrice(Product product, MembershipTier tier): BigDecimal

- tierê°€ WHOLESALEì´ê³  product.wholesalePriceê°€ ìˆìœ¼ë©´ wholesalePrice ë°˜í™˜
- ì•„ë‹ˆë©´ salePriceê°€ ìˆìœ¼ë©´ salePrice ë°˜í™˜
- ì•„ë‹ˆë©´ price ë°˜í™˜

#### API Endpoints

| Method | Endpoint                        | Description       | Auth Required |
| ------ | ------------------------------- | ----------------- | ------------- |
| GET    | /api/users/membership           | ë‚´ ë“±ê¸‰ ì •ë³´ ì¡°íšŒ | Yes           |
| POST   | /api/users/membership/wholesale | ë„ë§¤ íšŒì› ì‹ ì²­    | Yes           |

#### Error Handling

- ì‚¬ìš©ì ì—†ìŒ: 404 NOT_FOUND, "USER_NOT_FOUND"
- ì´ë¯¸ ë„ë§¤ íšŒì›: 400 BAD_REQUEST, "ALREADY_WHOLESALE_MEMBER"

#### Acceptance Criteria

- [x] GET /api/users/membership í˜¸ì¶œ ì‹œ í˜„ì¬ ë“±ê¸‰ ë° í˜œíƒ ì •ë³´ ë°˜í™˜
- [x] POST /api/users/membership/wholesale í˜¸ì¶œ ì‹œ ë„ë§¤ íšŒì› ì‹ ì²­ë¨
- [x] upgradeToVIP() í˜¸ì¶œ ì‹œ ì¡°ê±´ ë§Œì¡±í•˜ë©´ VIPë¡œ ìŠ¹ê¸‰ë¨
- [x] calculateMileage() í˜¸ì¶œ ì‹œ ë“±ê¸‰ë³„ ì ë¦½ë¥  ì ìš©ë¨
- [x] calculateShippingFee() í˜¸ì¶œ ì‹œ ë“±ê¸‰ë³„ ë°°ì†¡ë¹„ ë° ë¬´ë£Œ ë°°ì†¡ ê¸°ì¤€ ì ìš©ë¨
- [x] getCurrentPrice() í˜¸ì¶œ ì‹œ ë„ë§¤ íšŒì›ì—ê²Œ ë„ë§¤ê°€ ë°˜í™˜ë¨
- [x] (ì„ íƒ) ìë™ ìŠ¹ê¸‰ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ë§¤ì¼ ì‹¤í–‰ë¨

---

## ğŸ“Š Week 9-12 Summary

### Deliverables

- âœ… Mileage (ì ë¦½ê¸ˆ) Transaction ì‹œìŠ¤í…œ (ì ë¦½, ì‚¬ìš©, í™˜ë¶ˆ, ë§Œë£Œ)
- âœ… Deposit (ì˜ˆì¹˜ê¸ˆ) Transaction ì‹œìŠ¤í…œ (ì¶©ì „, ì‚¬ìš©, í™˜ë¶ˆ)
- âœ… Coupon ë°œê¸‰ ë° ì‚¬ìš© ì‹œìŠ¤í…œ
- âœ… Wishlist (ìœ„ì‹œë¦¬ìŠ¤íŠ¸) ê´€ë¦¬
- âœ… Membership Tier (íšŒì› ë“±ê¸‰) ì‹œìŠ¤í…œ

### Key Endpoints (Week 9-12)

| Method | Endpoint                              | Description              | Auth Required |
| ------ | ------------------------------------- | ------------------------ | ------------- |
| GET    | /api/users/mileage/balance            | ì ë¦½ê¸ˆ ì”ì•¡ ì¡°íšŒ         | Yes           |
| GET    | /api/users/mileage/history            | ì ë¦½ê¸ˆ ë‚´ì—­ ì¡°íšŒ         | Yes           |
| GET    | /api/users/deposit/balance            | ì˜ˆì¹˜ê¸ˆ ì”ì•¡ ì¡°íšŒ         | Yes           |
| GET    | /api/users/deposit/history            | ì˜ˆì¹˜ê¸ˆ ë‚´ì—­ ì¡°íšŒ         | Yes           |
| POST   | /api/users/deposit/charge             | ì˜ˆì¹˜ê¸ˆ ì¶©ì „              | Yes           |
| GET    | /api/coupons                          | ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ í° ëª©ë¡    | No            |
| POST   | /api/coupons/issue                    | ì¿ í° ë°œê¸‰                | Yes           |
| GET    | /api/users/coupons                    | ë‚´ ì¿ í° ëª©ë¡ ì¡°íšŒ        | Yes           |
| GET    | /api/users/wishlist                   | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¡°íšŒ          | Yes           |
| POST   | /api/users/wishlist                   | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì— ìƒí’ˆ ì¶”ê°€   | Yes           |
| DELETE | /api/users/wishlist/{productId}       | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ì—ì„œ ìƒí’ˆ ì œê±° | Yes           |
| GET    | /api/users/wishlist/check/{productId} | í¬í•¨ ì—¬ë¶€ í™•ì¸           | Yes           |
| GET    | /api/users/wishlist/count             | ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê°œìˆ˜ ì¡°íšŒ     | Yes           |
| GET    | /api/users/membership                 | ë‚´ ë“±ê¸‰ ì •ë³´ ì¡°íšŒ        | Yes           |
| POST   | /api/users/membership/wholesale       | ë„ë§¤ íšŒì› ì‹ ì²­           | Yes           |

### Frontend Integration Ready (Week 9-12)

í”„ë¡ íŠ¸ì—”ë“œ íŒ€ì´ ë‹¤ìŒ ê¸°ëŠ¥ì„ ì—°ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ë§ˆì´í˜ì´ì§€: ì ë¦½ê¸ˆ/ì˜ˆì¹˜ê¸ˆ ì”ì•¡ í‘œì‹œ
- ì£¼ë¬¸ ì‹œ ì ë¦½ê¸ˆ/ì˜ˆì¹˜ê¸ˆ ì‚¬ìš©
- ì¿ í° ëª©ë¡ ë° ë°œê¸‰
- ì£¼ë¬¸ ì‹œ ì¿ í° ì ìš©
- ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ (ì¶”ê°€/ì œê±°)
- ìƒí’ˆ ìƒì„¸ì—ì„œ ì°œ ë²„íŠ¼
- íšŒì› ë“±ê¸‰ ë° í˜œíƒ í‘œì‹œ

### Database Schema

**í…Œì´ë¸”:**

- mileage_transactions (ì ë¦½ê¸ˆ ê±°ë˜)
- deposit_transactions (ì˜ˆì¹˜ê¸ˆ ê±°ë˜)
- coupons (ì¿ í°)
- user_coupons (ì‚¬ìš©ìë³„ ì¿ í° ë°œê¸‰)
- wishlists (ìœ„ì‹œë¦¬ìŠ¤íŠ¸)

**ì¸ë±ìŠ¤:**

- mileage_transactions: user_id, expires_at
- deposit_transactions: user_id
- coupons: code (UNIQUE), is_active
- user_coupons: user_id, coupon_id, (user_id + coupon_id UNIQUE)
- wishlists: user_id, product_id, (user_id + product_id UNIQUE)

### Technical Highlights

- **Transaction ê¸°ë°˜ ì„¤ê³„**: ì ë¦½ê¸ˆ/ì˜ˆì¹˜ê¸ˆì€ ì”ì•¡ í•„ë“œ ì—†ì´ Transaction í•©ê³„ë¡œ ê³„ì‚°
- **Spring Scheduling**: ë§¤ì¼ ìì • ë§Œë£Œ ì ë¦½ê¸ˆ ìë™ ì°¨ê°
- **Enum í™œìš©**: ê±°ë˜ ìœ í˜•, í• ì¸ ìœ í˜•, íšŒì› ë“±ê¸‰ ê´€ë¦¬
- **ë³µí•© UNIQUE ì œì•½**: ì¤‘ë³µ ë°œê¸‰/ì¶”ê°€ ë°©ì§€
- **JOIN FETCH**: N+1 ë¬¸ì œ ë°©ì§€

### Business Logic

- **ì ë¦½ê¸ˆ ë§Œë£Œ**: ì ë¦½ì¼ë¡œë¶€í„° 1ë…„ í›„ ìë™ ë§Œë£Œ
- **ì¿ í° ì¤‘ë³µ ë°©ì§€**: í•œ ì‚¬ìš©ìë‹¹ 1íšŒ ë°œê¸‰
- **ìœ„ì‹œë¦¬ìŠ¤íŠ¸ ì¤‘ë³µ ë°©ì§€**: ë™ì¼ ìƒí’ˆ ì¤‘ë³µ ì¶”ê°€ ë¶ˆê°€
- **íšŒì› ë“±ê¸‰ í˜œíƒ**: ë“±ê¸‰ë³„ ì ë¦½ë¥ , ë°°ì†¡ë¹„, ë„ë§¤ê°€ ì—´ëŒ ì°¨ë“±
- **VIP ìë™ ìŠ¹ê¸‰**: ì—°ê°„ êµ¬ë§¤ ê¸ˆì•¡ 100ë§Œì› ì´ìƒ

### Next Steps (Week 13-17)

- ì¥ë°”êµ¬ë‹ˆ ì‹œìŠ¤í…œ (CartItem)
- ì£¼ë¬¸ ìƒì„± (Order, OrderItem)
- ë°°ì†¡ë¹„ ê³„ì‚° ë¡œì§
- ì£¼ë¬¸ ìƒíƒœ ê´€ë¦¬ (ê²°ì œ ëŒ€ê¸°, ê²°ì œ ì™„ë£Œ, ë°°ì†¡ ì¤‘ ë“±)
- ê²°ì œ Stub ì‹œìŠ¤í…œ (ì‹¤ì œ PGëŠ” Week 22-25)

---

**Documentation Style**: ì´ ë¬¸ì„œëŠ” ëª…ì‹œì ì¸ ì½”ë“œ ì˜ˆì‹œ ì—†ì´ ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ì„ í…ìŠ¤íŠ¸ë¡œ ìƒì„¸íˆ ì„¤ëª…í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê°œë°œìëŠ” ì´ ìš”êµ¬ì‚¬í•­ì„ ì½ê³  Java/Spring Boot ê¸°ë°˜ìœ¼ë¡œ ì§ì ‘ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
